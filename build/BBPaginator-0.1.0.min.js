(function(){var b;if(!this.BBLib){b=this.BBLib={};b.VERSION="0.1.0"}else{b=this.BBLib}b.PaginationModel=Backbone.Model.extend({defaults:{pageSize:10,page:0,numOfPages:0,numOfRecords:0},initialize:function(){this.on("change:numOfRecords change:pageSize",function(){var e=this.get("pageSize"),f=this.get("numOfRecords"),g=this.get("pageSize")===0?(f>0?1:0):Math.ceil(f/e);this.set("numOfPages",g);if(this.get("page")>=g){this.set("page",(g-1))}})},queryParamsMap:{},toQueryParams:function(){var e=_.extend({},this.attributes);if(!_.empty(this.queryParamsMap)){_.each(this.queryParamsMap,function(f,g){if(!g in this.attributes){throw new Error(g+" is not a valid property.")}e[f]=this.attributes[g]})}return e},validate:function(f,e){if(f.pageSize<0){return"Invalid pageSize value ["+f.pageSize+"]"}if(f.page<0||f.page>this.get("numOfPages")-1){return"Invalid currentPage value ["+f.currentPage+"]"}}});var d=b.PageSelectorView=Backbone.View.extend({tagName:"div",windowSize:5,className:"pagination numbers",fastForwardings:{first:"<<",last:">>",prev:"<",next:">"},template:_.template("<ul class='page-selector'>	<% _.each(pages, function(page) { %> 	<li class='page <%= page.cssClass %>'><a href='#'><%= page.label %></a></li> <% }) %>	</ul>"),events:{"click .page":"onClickChangePage"},initialize:function(e){e=e||{};this.windowSize=e.windowSize||this.windowSize;_.bindAll(this,"render");this.model.on("change:numOfPages change:page",this.render,this)},render:function(){this.$el.empty();pages=this.getDisplayPages();this.$el.html(this.template(pages));return this},getDisplayPages:function(){if(this.model.get("numOfPages")>0){var i=this.model.get("page"),j=this.model.get("numOfPages"),h=Math.max(1,Math.min(i+1-parseInt(this.windowSize/2),j+1-this.windowSize)),f=Math.min(this.model.get("numOfPages")+1,h+this.windowSize);var e=[{label:this.fastForwardings.first,cssClass:i==0?"disabled":""},{label:this.fastForwardings.prev,cssClass:i==0?"disabled":""},];var g=_.range(h,f,1);_.each(g,function(k){e.push({label:k,cssClass:i+1===k?"active":""})});e=e.concat([{label:this.fastForwardings.next,cssClass:i+1==j?"disabled":""},{label:this.fastForwardings.last,cssClass:i+1==j?"disabled":""},]);return e}else{return[]}},onClickChangePage:function(g){g.preventDefault();g.stopPropagation();var f=$(g.target).text().trim();var e=this.convertPageIndex(f);this.model.set("page",e,{validate:true})},convertPageIndex:function(e){var f=0,f=this.model.get("page"),g=this.model.get("numOfPages");switch(e){case this.fastForwardings.first:f=Math.min(0,g-1);break;case this.fastForwardings.prev:f=Math.max(0,f-1);break;case this.fastForwardings.next:f=Math.min(f+1,g-1);break;case this.fastForwardings.last:f=Math.max(0,g-1);break;default:f=parseInt(e)-1}return f}});var c=b.GotoPageView=Backbone.View.extend({tagName:"div",className:"pagination goto",events:{"blur input":"changePage","keypress input":"changePageOnEnter"},template:_.template("Goto <input type='text' value='<%= page + 1 %>'/> of <%= numOfPages %>"),initialize:function(){_.bindAll(this,"render");this.model.on("change",this.render,this)},render:function(){this.$el.empty();this.$el.html(this.template(this.model.attributes));return this},changePage:function(g){var f=$(g.target).val();var e=+f-1;if(_.isNaN(e)||e<=0||(e>(this.model.get("numOfPages")-1))){$(g.target).val(this.model.get("page")+1)}this.model.set("page",e,{validate:true})},changePageOnEnter:function(e){if(e.keyCode!=13){return}this.changePage(e)}});var a=b.PageSizeSelectorView=Backbone.View.extend({tagName:"div",className:"pagesize-selector",pageSizeOptions:["All",10,20],template:_.template("<div class='pagination'><ul class='pagesize-selector'> <% _.each(pageSizes, function(size) { %> <li class='page-size <%= pageSize==size ? 'active' : '' %>'><a href='#'><%= size %></a></li> <% }) %></ul></div>"),events:{"click .page-size":"onClickChangePageSize"},initialize:function(){_.bindAll(this,"render");this.model.on("change",this.render)},onClickChangePageSize:function(f){var g=$(f.target).text().trim();var e=this.convertPageSize(g);this.model.set("pageSize",e)},convertPageSize:function(f){var e=0;if(f=="All"){e=0}else{e=parseInt(f)}return e},render:function(){this.$el.empty();var e=this.model.get("pageSize");var f={pageSizes:this.pageSizeOptions,pageSize:e===0?"All":e};this.$el.html(this.template(f));return this}});b.PaginatorView=Backbone.View.extend({tagName:"div",className:"paginator",initialize:function(e){this.pageSelector=new d({model:this.model});this.gotoPage=new c({model:this.model})},render:function(){this.$el.empty();this.$el.append(this.pageSelector.render().el);var e=this.gotoPage.render().el;$(e).addClass("pull-right");this.$el.append(this.gotoPage.render().el);return this}})}).call(this);