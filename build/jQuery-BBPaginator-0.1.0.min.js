//BBPaginator wrapped with a jQuery plugin
;(function(){var a;if(typeof exports!=="undefined"){a=exports;}else{a=this.BBLib={};}a.VERSION="0.1.0";a.PaginationModel=Backbone.Model.extend({defaults:{pageSize:10,page:0,numOfPages:0,numOfRecords:0},initialize:function(){this.on("change:numOfRecords change:pageSize",function(){var d=this.get("pageSize"),e=this.get("numOfRecords"),f=this.get("pageSize")===0?(e>0?1:0):Math.ceil(e/d);this.set("numOfPages",f);if(this.get("page")>=f){this.set("page",(f-1));}});},queryParamsMap:{},toQueryParams:function(){var d=_.extend({},this.attributes);if(!_.empty(this.queryParamsMap)){_.each(this.queryParamsMap,function(e,f){if(!f in this.attributes){throw new Error(f+" is not a valid property.");}d[e]=this.attributes[f];});}return d;},validate:function(e,d){if(e.pageSize<0){return"Invalid pageSize value ["+e.pageSize+"]";}if(e.page<0||e.page>this.get("numOfPages")-1){return"Invalid currentPage value ["+e.currentPage+"]";}}});var c=a.PageSelectorView=Backbone.View.extend({tagName:"div",windowSize:5,className:"pagination numbers",fastForwardings:{first:"<<",last:">>",prev:"<",next:">"},template:_.template("<ul class='page-selector'>	<% _.each(pages, function(page) { %> 	<li class='page <%= page.cssClass %>'><a href='#'><%= page.label %></a></li> <% }) %>	</ul>"),events:{"click .page":"onClickChangePage"},initialize:function(d){d=d||{};this.windowSize=d.windowSize||this.windowSize;_.bindAll(this,"render");this.model.on("change",this.render);},render:function(){this.$el.empty();pages=this.getDisplayPages();this.$el.html(this.template(pages));return this;},getDisplayPages:function(){if(this.model.get("numOfPages")>0){var h=this.model.get("page"),i=this.model.get("numOfPages"),g=Math.max(1,Math.min(h+1-parseInt(this.windowSize/2),i+1-this.windowSize)),e=Math.min(this.model.get("numOfPages")+1,g+this.windowSize);var d=[{label:this.fastForwardings.first,cssClass:h==0?"disabled":""},{label:this.fastForwardings.prev,cssClass:h==0?"disabled":""}];var f=_.range(g,e,1);_.each(f,function(j){d.push({label:j,cssClass:h+1===j?"active":""});});d=d.concat([{label:this.fastForwardings.next,cssClass:h+1==i?"disabled":""},{label:this.fastForwardings.last,cssClass:h+1==i?"disabled":""}]);return d;}else{return[];}},onClickChangePage:function(f){f.preventDefault();f.stopPropagation();var e=$(f.target).text().trim();var d=this.convertPageIndex(e);this.model.set("page",d,{validate:true});},convertPageIndex:function(d){var e=0,e=this.model.get("page"),f=this.model.get("numOfPages");switch(d){case this.fastForwardings.first:e=Math.min(0,f-1);break;case this.fastForwardings.prev:e=Math.max(0,e-1);break;case this.fastForwardings.next:e=Math.min(e+1,f-1);break;case this.fastForwardings.last:e=Math.max(0,f-1);break;default:e=parseInt(d)-1;}return e;}});var b=a.GotoPageView=Backbone.View.extend({tagName:"div",className:"pagination goto",events:{"blur input":"changePage","keypress input":"changePageOnEnter"},template:_.template("Goto <input type='text' value='<%= page + 1 %>'/> of <%= numOfPages %>"),initialize:function(){_.bindAll(this,"render");this.model.on("change",this.render);},render:function(){this.$el.empty();this.$el.html(this.template(this.model.attributes));return this;},changePage:function(f){var e=$(f.target).val();var d=+e-1;if(_.isNaN(d)||d<=0||(d>(this.model.get("numOfPages")-1))){$(f.target).val(this.model.get("page")+1);}this.model.set("page",d,{validate:true});},changePageOnEnter:function(d){if(d.keyCode!=13){return;}this.changePage(d);}});a.PaginatorView=Backbone.View.extend({tagName:"div",className:"paginator",initialize:function(d){this.pageSelector=new c({model:this.model});this.gotoPage=new b({model:this.model});},render:function(){this.$el.empty();this.$el.append(this.pageSelector.render().el);var d=this.gotoPage.render().el;$(d).addClass("pull-right");this.$el.append(this.gotoPage.render().el);return this;}});}).call(this);
(function(a){a.fn.paginator=function(b){b=a.extend({page:0,pageSize:10,numOfPages:3,numOfRecords:30},b);return this.each(function(){var f=_.pick(b,"page","pageSize","numOfPages","numOfRecords"),d=new BBLib.PaginationModel(f);if(a.isFunction(b.onPageChange)){d.on("change:page",b.onPageChange);}var e=a(this),c=new BBLib.PaginatorView({model:d,el:e});e.empty();e.append(c.render().el);e.data("model",d);e.data("view",c);});};})(jQuery);
